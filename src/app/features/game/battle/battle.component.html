<div class="battle-arena" *ngIf="battleConfig && enemy && playerCharacter">
    <div class="corner-decoration corner-tl"></div>
    <div class="corner-decoration corner-tr"></div>
    <div class="corner-decoration corner-bl"></div>
    <div class="corner-decoration corner-br"></div>

    <div class="top-hud">
        <h2 class="battle-title">{{ battleConfig.title }}</h2>
        <div class="timer">{{ timerDisplay }}</div>
    </div>

    <div class="battle-field">
        <div class="character-container">
            <div class="character-model">
                <div class="energy-aura"></div>
                <div class="player-avatar">
                  <div class="avatar-frame"></div>
                  <div class="class-icon-display">{{ playerCharacter.class_icon }}</div>
                  <div class="race-icon-display">{{ playerCharacter.race_icon }}</div>
                </div>
            </div>
            <div class="status-panel">
                <h3 class="character-name">{{ playerCharacter.name }}</h3>
                <div class="status-bars">
                    <div class="stat-row">
                        <div class="stat-icon">‚ù§Ô∏è</div>
                        <div class="stat-info">
                            <div class="stat-label">Vida</div>
                            <div class="stat-bar">
                                <div class="stat-fill health" [style.width.%]="(playerHealth / playerMaxHealth) * 100">
                                    <span class="stat-value">{{ playerHealth }}/{{ playerMaxHealth }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-icon">‚ö°</div>
                        <div class="stat-info">
                            <div class="stat-label">Energia</div>
                            <div class="stat-bar">
                                <div class="stat-fill energy" [style.width.%]="(playerEnergy / playerMaxEnergy) * 100">
                                    <span class="stat-value">{{ playerEnergy }}/{{ playerMaxEnergy }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-icon">‚öîÔ∏è</div>
                        <div class="stat-info">
                            <div class="stat-label">Poder</div>
                            <div class="stat-bar">
                                <div class="stat-fill power" [style.width.%]="(playerPower / playerMaxPower) * 100">
                                    <span class="stat-value">{{ playerPower }}/{{ playerMaxPower }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="center-stage">
            <div class="dialog-container" *ngIf="showDialog && dialog.length > 0">
                <div class="dialog-balloon" [ngClass]="{'player-speaking': dialog[currentDialogIndex].speaker !== enemy.name, 'enemy-speaking': dialog[currentDialogIndex].speaker === enemy.name}">
                    <span class="speaker-name">{{ dialog[currentDialogIndex].speaker === 'Zephyr Nova' ? playerCharacter.name : dialog[currentDialogIndex].speaker }}:</span>
                    <p class="dialog-text">{{ dialog[currentDialogIndex].text }}</p>
                    <button class="next-dialog-btn" (click)="nextDialog()">{{ currentDialogIndex === dialog.length - 1 ? 'Iniciar Batalha' : 'Pr√≥ximo' }}</button>
                </div>
            </div>
            <div class="turn-indicator" *ngIf="!showDialog">
                <div class="turn-text">{{ isPlayerTurn ? 'Sua vez' : 'Vez do oponente' }}</div>
                <div class="turn-arrow" [class.enemy-turn]="!isPlayerTurn"></div>
            </div>
        </div>

        <div class="enemy-container">
            <div class="enemy-model">
                <div class="energy-aura"></div>
                <div class="enemy-visual"></div>
            </div>
            <div class="status-panel">
                <h3 class="character-name">{{ enemy.name }}</h3>
                <div class="status-bars">
                    <div class="stat-row">
                        <div class="stat-icon">‚ù§Ô∏è</div>
                        <div class="stat-info">
                            <div class="stat-label">Vida</div>
                            <div class="stat-bar">
                                <div class="stat-fill health" [style.width.%]="(enemy.health / enemy.maxHealth) * 100">
                                    <span class="stat-value">{{ enemy.health }}/{{ enemy.maxHealth }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-icon">‚ö°</div>
                        <div class="stat-info">
                            <div class="stat-label">Energia</div>
                            <div class="stat-bar">
                                <div class="stat-fill energy" style="width: 80%">
                                    <span class="stat-value">3200/4000</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-icon">‚öîÔ∏è</div>
                        <div class="stat-info">
                            <div class="stat-label">Poder</div>
                            <div class="stat-bar">
                                <div class="stat-fill power" style="width: 90%">
                                    <span class="stat-value">2700/3000</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="stat-row">
                        <div class="stat-icon">üõ°Ô∏è</div>
                        <div class="stat-info">
                            <div class="stat-label">Defesa</div>
                            <div class="stat-bar">
                                <div class="stat-fill defense" style="width: 95%">
                                    <span class="stat-value">2375/2500</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="action-panel">
        <div class="action-btn-wrapper" (mouseenter)="showMenu('attack')" (mouseleave)="hideMenu()">
            <button class="action-btn attack" [disabled]="!isPlayerTurn">‚öîÔ∏è Atacar</button>
            <div class="sub-action-panel" *ngIf="activeMenu === 'attack'" (mouseenter)="showMenu('attack')">
                <h1 class="sub-action-title">Sugest√µes de Ataque</h1>
                <button class="sub-action-btn" (click)="selectAction('Ataque B√°sico')">Ataque B√°sico: 15 de dano</button>
            </div>
        </div>
        <div class="action-btn-wrapper" (mouseenter)="showMenu('special')" (mouseleave)="hideMenu()">
            <button class="action-btn special" [disabled]="!isPlayerTurn">‚ú® Especial</button>
            <div class="sub-action-panel" *ngIf="activeMenu === 'special'" (mouseenter)="showMenu('special')">
                <h1 class="sub-action-title">Sugest√µes de Especial</h1>
                <button class="sub-action-btn" (click)="selectAction(specialAttack)">{{specialAttack}}</button>
            </div>
        </div>
        <div class="action-btn-wrapper" (mouseenter)="showMenu('defend')" (mouseleave)="hideMenu()">
            <button class="action-btn defend" [disabled]="!isPlayerTurn">üõ°Ô∏è Defender</button>
            <div class="sub-action-panel" *ngIf="activeMenu === 'defend'" (mouseenter)="showMenu('defend')">
                <h1 class="sub-action-title">Sugest√µes de Defesa</h1>
                <button class="sub-action-btn" (click)="selectAction(defendAction)">{{defendAction}}</button>
            </div>
        </div>
        <div class="action-btn-wrapper" (mouseenter)="showMenu('item')" (mouseleave)="hideMenu()">
            <button class="action-btn" [disabled]="!isPlayerTurn">üíä Item</button>
            <div class="sub-action-panel" *ngIf="activeMenu === 'item'" (mouseenter)="showMenu('item')">
                <h1 class="sub-action-title">Sugest√µes de Item</h1>
                <button class="sub-action-btn" (click)="selectAction(item)">{{item}}</button>
            </div>
        </div>
        <div class="action-btn-wrapper">
            <button class="action-btn" [disabled]="!isPlayerTurn">üöÄ Fugir</button>
        </div>
    </div>

    <div class="input-container">
        <input type="text" class="action-input" placeholder="A√ß√£o selecionada..." [(ngModel)]="selectedAction" [disabled]="!isPlayerTurn">
    </div>
</div>